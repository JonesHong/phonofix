"""
中文拼音模糊音配置模組

此模組包含所有拼音相關的配置,包括:
- 聲母模糊群組 (捲舌音、n/l 不分、r/l 混淆、f/h 混淆)
- 韻母模糊對應 (in/ing, en/eng, ue/ie 等)
- 特例音節映射 (整體音節的特殊對應)

這些配置支援台灣國語、客家口音等常見的中文發音變體。
"""


class PhoneticConfig:
    """拼音配置類別 - 集中管理所有拼音模糊音規則"""

    # ==========================================
    # 聲母模糊群組配置
    # ==========================================
    # 用於處理捲舌音與非捲舌音的模糊比對 (如 z vs zh)
    # 擴展支援台灣國語特徵: n/l 不分、r/l 混淆、f/h 混淆
    FUZZY_INITIALS_MAP = {
        "z": "z_group",
        "zh": "z_group",
        "c": "c_group",
        "ch": "c_group",
        "s": "s_group",
        "sh": "s_group",
        "n": "n_l_group",
        "l": "n_l_group",  # n/l 不分 (台灣國語)
        "r": "r_l_group",  # r 變 l (如「日」近「力」)
        "f": "f_h_group",
        "h": "f_h_group",  # 發/花 混淆
    }

    # ==========================================
    # 韻母模糊對應配置
    # ==========================================
    # 處理台灣國語常見的韻母混淆
    FUZZY_FINALS_PAIRS = [
        ("in", "ing"),
        ("en", "eng"),
        ("an", "ang"),
        # ian / iang: 如「先 / 香」一帶
        ("ian", "iang"),
        # uan / uang: 「關 / 光」一帶
        ("uan", "uang"),
        # uan / an: u 被吃掉,如「uan」念成「an」
        ("uan", "an"),
        # ong / eng / on: 鼻音尾不清楚
        ("ong", "eng"),
        ("ong", "on"),
        # uo / o / ou: 口型沒開完整
        ("uo", "o"),
        ("uo", "ou"),
        # ue / ie: 「學 / 鞋」系列 (xue/xie, jue/jie, que/qie, nue/nie, lue/lie)
        ("ue", "ie"),
    ]

    # ==========================================
    # 特例音節映射 (雙向版本 - 用於詞典生成)
    # ==========================================
    # 無法只靠聲母/韻母替換處理的口音,直接整個音節對應
    # 這是雙向映射,用於生成所有可能的變體
    SPECIAL_SYLLABLE_MAP_BIDIRECTIONAL = {
        # --- f <-> h 系列 (雙向) ---
        "fa": ["hua"],
        "hua": ["fa"],
        "fei": ["hui"],
        "hui": ["fei"],
        "fan": ["huan"],
        "huan": ["fan"],
        "feng": ["hong"],
        "hong": ["feng"],
        "fu": ["hu"],
        "hu": ["fu"],
        # --- ue / ie 混淆 (雙向) ---
        "xue": ["xie"],
        "xie": ["xue"],
        "jue": ["jie"],
        "jie": ["jue"],
        "que": ["qie"],
        "qie": ["que"],
        "nue": ["nie"],
        "nie": ["nue"],
        "lue": ["lie"],
        "lie": ["lue"],
        # --- r <-> y/l (雙向) ---
        "ran": ["lan", "yan"],
        "rou": ["lou"],
        "re": ["le"],
        # --- w <-> h/m (雙向) ---
        "wei": ["hui"],
        "wan": ["huan"],
        # --- 兒化音弱化 or 誤加 (雙向) ---
        "er": ["e"],
        "e": ["er"],
        # --- 其他常見發音飄移 (雙向) ---
        "weng": ["wen"],
        "wen": ["weng"],
        "yong": ["iong"],
        "iong": ["yong"],
        # --- 拼音合法性修補 (雙向) ---
        "ren": ["lun", "leng"],
        "nen": ["lun", "leng"],
    }

    # ==========================================
    # 特例音節映射 (單向版本 - 用於文本修正)
    # ==========================================
    # 這是單向映射,只允許 常見誤讀 -> 正確讀音
    # 避免將正確的詞誤改為錯誤的讀音
    SPECIAL_SYLLABLE_MAP_UNIDIRECTIONAL = {
        # --- f <-> h 系列 (只允許 h -> f) ---
        "hua": ["fa"],  # 花 -> 發
        "hui": ["fei"],  # 輝 -> 飛
        "huan": ["fan"],  # 換 -> 飯
        "hong": ["feng"],  # 轟 -> 風
        "fu": ["hu"],  # 負 -> 護
        # --- ue / ie 混淆 (只允許 ie -> ue) ---
        "xie": ["xue"],  # 鞋 -> 學
        "jie": ["jue"],  # 結 -> 覺
        "qie": ["que"],  # 切 -> 確
        "nie": ["nue"],  # 捏 -> 虐
        "lie": ["lue"],  # 列 -> 略
        # --- r <-> y/l (只允許 l/y -> r) ---
        "lan": ["ran"],  # 蘭 -> 然
        "yan": ["ran"],  # 嚴 -> 然
        "lou": ["rou"],  # 漏/樓 -> 肉
        # 注意: 移除 "re": ["le"],避免「了」被誤改為「熱」
        # --- w <-> h (只允許 h -> w) ---
        "hui": ["wei"],  # 輝 -> 微 (注意: 這會與上面的 hui->fei 衝突,需要在應用時處理)
        "huan": ["wan"],  # 換 -> 彎 (注意: 這會與上面的 huan->fan 衝突)
        # --- 兒化音弱化 or 誤加 ---
        "e": ["er"],  # e -> 兒 (有些人會多一個兒化)
        # --- 其他常見發音飄移 ---
        "wen": ["weng"],  # 文 -> 翁
        "iong": ["yong"],  # 用 iong 拼音 -> yong
        # --- 拼音合法性修補 (Crucial Fixes) ---
        # 解決 r -> l 產生的非法拼音 (如 len 不存在)
        "lun": ["ren"],  # 論 -> 認
        "leng": ["ren"],  # 冷 -> 認
    }

    # ==========================================
    # 黏音 / 懶音短語映射
    # ==========================================
    # 整句對整句的特例
    # 標準說法 -> 常見懶讀/搞笑聽感寫法
    STICKY_PHRASE_MAP = {
        "歡迎光臨": ["緩光您", "歡光您"],
        "謝謝光臨": ["寫光您"],
        "不好意思": ["報意思", "鮑意思", "不意思", "報思"],
        "對不起": ["對不擠", "對七", "瑞不七"],
        "不知道": ["幫道", "不道", "苞道", "不造"],
        "為什麼": ["為什", "位什", "為某", "餵墨"],
        "什麼": ["甚", "神馬", "什"],
        "就是": ["救世", "糾是", "舊是"],
        "真的": ["珍的", "貞的", "蒸的"],
        "這樣": ["醬", "這樣", "窄樣"],
        "那樣": ["釀", "那樣"],
        "可以": ["科以", "可一", "凱"],
        "便宜": ["皮宜", "頻宜"],
        "而且": ["鵝且", "額且", "二且"],
        "然後": ["那後", "腦後", "挪"],
        "大家好": ["搭好", "大好", "家好"],
        "先生": ["鮮生", "仙", "軒", "先嗯"],
        "小姐": ["小解", "小節"],
        "根本": ["跟本", "公本"],
        "這邊": ["這嗯"],
        "今天的": ["尖的"],
        "需要": ["蕭"],
        "收您": ["SONY"],
    }

    # ==========================================
    # 口語助詞 / 雜訊字
    # ==========================================
    # 之後做比對時可選擇忽略
    SKIP_PARTICLES = {
        "啦",
        "啊",
        "喔",
        "哦",
        "呢",
        "嘛",
        "呀",
        "欸",
        "誒",
        "咧",
        "耶",
        "嗯",
        "恩",
    }

    @classmethod
    def build_group_to_initials_map(cls):
        """
        建構反向映射: group -> 可能的聲母列表
        用於在模糊匹配時快速查找同組的所有聲母

        Returns:
            dict: 群組到聲母列表的映射
        """
        group_to_initials = {}
        for init, group in cls.FUZZY_INITIALS_MAP.items():
            if group not in group_to_initials:
                group_to_initials[group] = []
            group_to_initials[group].append(init)

        # l 也可能變成 r (補回去,因為 r -> l 是單向的)
        if "r_l_group" in group_to_initials:
            if "l" not in group_to_initials["r_l_group"]:
                group_to_initials["r_l_group"].append("l")

        return group_to_initials
